// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../contract.sol";

contract MockERC20Bad is IERC20 {
    function transferFrom(address, address, uint256) external pure returns (bool) { return false; }
    function approve(address, uint256) external pure returns (bool) { return true; }
}

contract Exploit_008_unchecked_approval_drain is Test {
    function testExploit_IgnoresFailedTransferAndSetsUnlimitedApproval() public {
        MockERC20Bad t = new MockERC20Bad();
        address spender = address(0xBEEF);
        UncheckedApprovalDrain u = new UncheckedApprovalDrain(address(t), spender);

        // should not revert despite transferFrom returning false
        u.sweep(address(0xCAFE), 1 ether);

        // should not revert and gives max approval path
        u.setUnlimitedApproval();
        assertTrue(true, "unchecked paths execute without safeguards");
    }
}
